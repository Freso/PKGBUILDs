#!/bin/sh

INTERFACE=$1
STATUS=$2

# Make sure we're always getting the standard response strings
LANG='C'

CHRONY=/usr/bin/chronyc
STATECMD='nmcli -t --fields STATE g'


case "$STATUS" in
  up)
    $CHRONY -a online
  ;;
  vpn-up)
    $CHRONY -a online
  ;;
  down)
    # Check for active interface, take offline if none is active
    if [ ! `${STATECMD}` = 'connected' ]; then
      $CHRONY -a offline
    fi
  ;;
  vpn-down)
    # Check for active interface, take offline if none is active
    if [ ! `${STATECMD}` = 'connected' ]; then
      $CHRONY -a offline
    fi
  ;;
esac
